!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("axios"),require("sip.js")):"function"==typeof define&&define.amd?define(["axios","sip.js"],t):e["@wazo/sdk"]=t(e.axios,e.SIP)}(this,function(e,t){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t;var n={server:null,token:null};var a=t=>{const a=`https://${n.server}/api/auth/0.1/token`,i={backend:t.backend||"wazo_user",expiration:t.expiration||3600},s={auth:{username:t.username,password:t.password}};e.post(a,i,s).then(e=>((e,t)=>{n.token=e.data.data.token,t&&t(n.token)})(e,t.callback))};var i=t=>{if(n.token){const a=`https://${n.server}/api/auth/0.1/token/${n.token}`;e.delete(a).then((e=>{n.token=null,e&&e(n.token)})(t.callback))}};const s=["STATUS_NULL","STATUS_NEW","STATUS_CONNECTING","STATUS_CONNECTED","STATUS_COMPLETED"];return{client:class{constructor(e){this.logIn=a,this.logOut=i,this.server=e}},init:e=>{n.server=e.server},logIn:a,logOut:i,calls:t=>{const a=`https://${n.server}/api/ctid-ng/1.0/applications/${t.applicationUuid}/calls`,i={headers:{"X-Auth-Token":t.token,"Content-Type":"application/json"}};e.get(a,i).then(e=>((e,t)=>{n.data=e.data,t&&t(n.data)})(e,t.callback))},hangupCall:t=>{const a=`https://${n.server}/api/ctid-ng/1.0/applications/${t.applicationUuid}/calls/${t.callID}`,i={headers:{"X-Auth-Token":t.token,"Content-Type":"application/json"}};e.delete(a,i).then(e=>((e,t)=>{n.data=e.data,t&&t(n.data)})(e,t.callback))},AnswerCall:t=>{const a=`https://${n.server}/api/ctid-ng/1.0/applications/${t.applicationUuid}/nodes`,i={calls:[{id:t.callID}]},s={headers:{"X-Auth-Token":t.token,"Content-Type":"application/json"}};e.post(a,i,s).then(e=>((e,t)=>{n.data=e.data,t&&t(n.data)})(e,t.callback))},WebRTCPhone:class{constructor(e,t){this.config=e,this.ua=this.configureUa(),this.callback=t}configureUa(){const e=new t.Web.Simple(this.getConfig());return e.on("registered",()=>{this.callback("phone-events-registered")}),e.on("unregistered",()=>{this.callback("phone-events-unregistered")}),e.on("new",e=>{const t={callerid:function(e){return{caller_id_name:e.remoteIdentity.displayName,caller_id_number:e.remoteIdentity.uri.user}}(e),autoanswer:function(e){return!!e.getHeader("alert-info")}(e.request)};this.callback("phone-events-new",t)}),e.on("ringing",()=>{this.callback("phone-events-ringing")}),e.on("connected",()=>{this.callback("phone-events-connected")}),e.on("ended",()=>{this.callback("phone-events-ended")}),e}getConfig(){return{media:{remote:{audio:this.config.media.audio}},ua:{traceSip:!1,displayName:this.config.displayName,uri:this.config.uri,wsServers:this.config.wsServers,authorizationUser:this.config.authorizationUser,password:this.config.password,sessionDescriptionHandlerFactoryOptions:{peerConnectionOptions:{iceCheckingTimeout:500,rtcpMuxPolicy:"negotiate",rtcConfiguration:{iceServers:{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302"]}}}}}}}getState(){return s[this.ua.state]}call(e){/^\+?[0-9#*]+$/.exec(e)&&this.ua.call(e)}answer(){this.ua.answer()}reject(){this.ua.reject()}hangup(){this.ua.hangup()}}}});
